machine:
  services:
    - docker

dependencies:
  override:
    - docker pull aussielunix/fpm-cook:ubuntu_14.04
    - docker run --rm --name ubuntu-trusty-packer-deb -v $PWD:/data -i -t aussielunix/fpm-cook:ubuntu_14.04 fpm-cook package --pkg-dir=/pkg/ -t deb -p ubuntu recipe.rb

general:
  artifacts:
    - /pkg/

deployment:
  production:
    branch: master
    commands:
      - package_cloud push aussielunix/packer/ubuntu/14.04 $CIRCLE_ARTIFACTS/pkg/packer_0.7.2-1_amd64.deb
