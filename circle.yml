machine:
  services:
    - docker

dependencies:
  override:
    - mkdir workdir
    - docker info
    - docker build --rm -t aussielunix/fpm-cookery-packer .
    - docker run --rm --name ubuntu-trusty-packer-deb -v `pwd`/workdir:/workdir -i -t aussielunix/fpm-cookery-packer

general:
  artifacts:
    - /workdir

deployment:
  production:
    branch: master
    commands:
      - package_cloud push aussielunix/packer/ubuntu/14.04 $CIRCLE_ARTIFACTS/pkg/packer_0.7.2-1_amd64.deb
